{"version":3,"file":"src_app_pages_profile_change-profile-picture_change-profile-picture_change-profile-picture_mo-9a34fe.js","mappings":"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","sources":["./src/app/pages/profile/change-profile-picture/change-profile-picture/change-profile-picture-routing.module.ts","./src/app/pages/profile/change-profile-picture/change-profile-picture/change-profile-picture.module.ts","./src/app/pages/profile/change-profile-picture/change-profile-picture/change-profile-picture.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ChangeProfilePicturePage } from './change-profile-picture.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ChangeProfilePicturePage\n  },\n  {\n    path: 'confirm',\n    loadChildren: () => import('../confirm/confirm.module').then( m => m.ConfirmPageModule)\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ChangeProfilePicturePageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ChangeProfilePicturePageRoutingModule } from './change-profile-picture-routing.module';\n\nimport { ChangeProfilePicturePage } from './change-profile-picture.page';\nimport { ImageCropperPageModule } from 'src/app/modals/image-cropper/image-cropper.module';\n\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ChangeProfilePicturePageRoutingModule,\n    ImageCropperPageModule\n  ],\n  declarations: [ChangeProfilePicturePage]\n})\nexport class ChangeProfilePicturePageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ProfileService } from '../../../../services/profile.service';\nimport { PhotoService } from '../../../../services/photo.service';\nimport { AlertController, ToastController, LoadingController, ModalController } from '@ionic/angular';\nimport { environment } from '../../../../../environments/environment';\nimport { ImageCropperPage } from 'src/app/modals/image-cropper/image-cropper.page';\nimport { PostPageEmitterService } from 'src/app/emitters/post-page-emitter.service';\nimport { SinglePostPageEmitterService } from 'src/app/emitters/single-post-page-emitter.service';\n\n\n\n\n@Component({\n  selector: 'app-change-profile-picture',\n  templateUrl: './change-profile-picture.page.html',\n  styleUrls: ['./change-profile-picture.page.scss'],\n})\nexport class ChangeProfilePicturePage implements OnInit {\n  formData: FormData;\n  imageUrl = this.profile.profilePicture.getValue();\n  uploadedPhotoURL;\n  uploadedPhoto = false;\n  awsPrefix = this.imageUrl.slice(-51);\n  userEmail: any;\n  BACKEND_URL = environment.url;\n\n  constructor(\n    private photo: PhotoService,\n    private router: Router,\n    private profile: ProfileService,\n    private alert: AlertController,\n    private modal: ModalController,\n    private toast: ToastController,\n    private loading: LoadingController,\n    private postEmitter: PostPageEmitterService,\n    private singlePostEmitterService: SinglePostPageEmitterService,\n    ) { }\n\n  ngOnInit() {\n    this.profile.getUserDetails()\n      .subscribe(\n        data => {\n          this.userEmail = data['email'];\n          console.log(this.userEmail);\n        }\n      );\n  }\n\n  async getFormData(event) {\n   const formElement = document.querySelectorAll('form');\n   await formElement.forEach(form => {\n    if ( form.id === 'changePhotoForm') {\n      console.log('Got Form: ' + form);\n      this.formData = new FormData(form);\n      this.uploadedPhoto = true;\n    }\n   });\n\n   console.log(this.formData);\n\n   let reader = new FileReader();\n   await reader.addEventListener('load', async () => {\n     // convert image file to base64 string\n     this.uploadedPhotoURL = reader.result;\n     console.log('Before cropping: ' + reader.result);\n     await this.cropPhoto(this.uploadedPhotoURL);\n   }, true);\n\n   if (formElement) {\n     return reader.readAsDataURL(event.target.files[0]);\n   }\n }\n\n uploadChangedPhoto() {\n\n  const formData = new FormData();\n  formData.append('oldPhotoKey', this.awsPrefix);\n  formData.append('email', this.userEmail);\n\n  const photoFile = new File([this.dataURLtoBlob(this.uploadedPhotoURL)], 'picture.png');\n\n  formData.append('profile-picture-update', photoFile);\n\n  if (this.uploadedPhoto === true) {\n    this.photo.changeProfilePicture(formData).subscribe(\n      data => {\n        console.log(data);\n        let newPhoto = data['objectUrl'];\n        // Update all the creatorProfilePicture properties with newPhoto\n        // this.photo.updatePostPhotos(newPhoto, this.userEmail);\n        this.presentLoading();\n        this.profile.profilePicture.next(newPhoto);\n        this.presentToast();\n        // Get profile pages to refresh with updated profile pics\n        this.postEmitter.postPageRefresh();\n        this.singlePostEmitterService.singlePostPageRefresh();\n        this.router.navigate(['/home/profile']);\n      }\n    );\n  }\n }\n\nasync presentToast() {\n  const toast = await this.toast.create({\n    message: 'Your Profile Picture has been changed',\n    animated: true,\n    cssClass: 'updated-toast',\n    duration: 2000\n  });\n  toast.present();\n}\n\nasync presentLoading() {\n  const loading = await this.loading.create({\n    cssClass: 'my-custom-class',\n    message: 'Updating Photo...',\n    duration: 1000\n  });\n  await loading.present();\n\n  const { role, data } = await loading.onDidDismiss();\n  console.log('Loading dismissed!');\n}\n\nasync cropPhoto(uploadedPhotoURL) {\n  const modal = await this.modal.create({\n    component: ImageCropperPage,\n    cssClass: 'image-cropper',\n    componentProps: {\n      uploadedPhotoURL\n    }\n  });\n\n  await modal.present();\n\n  modal.onDidDismiss().then(data => {\n    this.uploadedPhotoURL = data.data;\n  });\n\n\n}\n\ndataURLtoBlob(dataurl) {\n  let arr = dataurl.split(',');\n  let mime = arr[0].match(/:(.*?);/)[1];\n  let bstr = atob(arr[1]);\n  let n = bstr.length;\n  let u8arr = new Uint8Array(n);\n\n  while(n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new Blob([u8arr], {type: mime});\n}\n\ngoBack() {\n  this.router.navigate(['/home/profile']);\n}\n\n}\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}