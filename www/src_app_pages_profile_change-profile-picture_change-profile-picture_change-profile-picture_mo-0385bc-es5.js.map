{"version":3,"mappings":"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","names":["routes","path","component","_change_profile_picture_page__WEBPACK_IMPORTED_MODULE_0__","loadChildren","__webpack_require__","then","m","ConfirmPageModule","ChangeProfilePicturePageRoutingModule","imports","_angular_router__WEBPACK_IMPORTED_MODULE_3__","exports","ChangeProfilePicturePageModule","_angular_common__WEBPACK_IMPORTED_MODULE_5__","_angular_forms__WEBPACK_IMPORTED_MODULE_6__","_ionic_angular__WEBPACK_IMPORTED_MODULE_7__","_change_profile_picture_routing_module__WEBPACK_IMPORTED_MODULE_0__","src_app_modals_image_cropper_image_cropper_module__WEBPACK_IMPORTED_MODULE_2__","declarations","_change_profile_picture_page__WEBPACK_IMPORTED_MODULE_1__","ChangeProfilePicturePage","photo","router","profile","alert","modal","toast","loading","postEmitter","singlePostEmitterService","profilePicture","getValue","imageUrl","slice","_environments_environment__WEBPACK_IMPORTED_MODULE_4__","getUserDetails","subscribe","userEmail","data","console","log","event","formElement","document","querySelectorAll","forEach","form","id","formData","FormData","uploadedPhoto","reader","FileReader","addEventListener","uploadedPhotoURL","result","cropPhoto","readAsDataURL","target","files","append","awsPrefix","photoFile","File","dataURLtoBlob","changeProfilePicture","newPhoto","presentLoading","next","presentToast","postPageRefresh","singlePostPageRefresh","navigate","create","message","animated","cssClass","duration","present","onDidDismiss","role","src_app_modals_image_cropper_image_cropper_page__WEBPACK_IMPORTED_MODULE_5__","componentProps","dataurl","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","Blob","type","_services_photo_service__WEBPACK_IMPORTED_MODULE_3__","_angular_router__WEBPACK_IMPORTED_MODULE_9__","_services_profile_service__WEBPACK_IMPORTED_MODULE_2__","_ionic_angular__WEBPACK_IMPORTED_MODULE_10__","src_app_emitters_post_page_emitter_service__WEBPACK_IMPORTED_MODULE_6__","src_app_emitters_single_post_page_emitter_service__WEBPACK_IMPORTED_MODULE_7__","selector","template","__webpack_exports__"],"sources":["webpack:///src/app/pages/profile/change-profile-picture/change-profile-picture/change-profile-picture-routing.module.ts","webpack:///src/app/pages/profile/change-profile-picture/change-profile-picture/change-profile-picture.module.ts","webpack:///src/app/pages/profile/change-profile-picture/change-profile-picture/change-profile-picture.page.ts","webpack:///src/app/pages/profile/change-profile-picture/change-profile-picture/change-profile-picture.page.html"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ChangeProfilePicturePage } from './change-profile-picture.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ChangeProfilePicturePage\n  },\n  {\n    path: 'confirm',\n    loadChildren: () => import('../confirm/confirm.module').then( m => m.ConfirmPageModule)\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ChangeProfilePicturePageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ChangeProfilePicturePageRoutingModule } from './change-profile-picture-routing.module';\n\nimport { ChangeProfilePicturePage } from './change-profile-picture.page';\nimport { ImageCropperPageModule } from 'src/app/modals/image-cropper/image-cropper.module';\n\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ChangeProfilePicturePageRoutingModule,\n    ImageCropperPageModule\n  ],\n  declarations: [ChangeProfilePicturePage]\n})\nexport class ChangeProfilePicturePageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ProfileService } from '../../../../services/profile.service';\nimport { PhotoService } from '../../../../services/photo.service';\nimport { AlertController, ToastController, LoadingController, ModalController } from '@ionic/angular';\nimport { environment } from '../../../../../environments/environment';\nimport { ImageCropperPage } from 'src/app/modals/image-cropper/image-cropper.page';\nimport { PostPageEmitterService } from 'src/app/emitters/post-page-emitter.service';\nimport { SinglePostPageEmitterService } from 'src/app/emitters/single-post-page-emitter.service';\n\n\n\n\n@Component({\n  selector: 'app-change-profile-picture',\n  templateUrl: './change-profile-picture.page.html',\n  styleUrls: ['./change-profile-picture.page.scss'],\n})\nexport class ChangeProfilePicturePage implements OnInit {\n  formData: FormData;\n  imageUrl = this.profile.profilePicture.getValue();\n  uploadedPhotoURL;\n  uploadedPhoto = false;\n  awsPrefix = this.imageUrl.slice(-51);\n  userEmail: any;\n  BACKEND_URL = environment.url;\n\n  constructor(\n    private photo: PhotoService,\n    private router: Router,\n    private profile: ProfileService,\n    private alert: AlertController,\n    private modal: ModalController,\n    private toast: ToastController,\n    private loading: LoadingController,\n    private postEmitter: PostPageEmitterService,\n    private singlePostEmitterService: SinglePostPageEmitterService,\n    ) { }\n\n  ngOnInit() {\n    this.profile.getUserDetails()\n      .subscribe(\n        data => {\n          this.userEmail = data['email'];\n          console.log(this.userEmail);\n        }\n      );\n  }\n\n  async getFormData(event) {\n   const formElement = document.querySelectorAll('form');\n   await formElement.forEach(form => {\n    if ( form.id === 'changePhotoForm') {\n      console.log('Got Form: ' + form);\n      this.formData = new FormData(form);\n      this.uploadedPhoto = true;\n    }\n   });\n\n   console.log(this.formData);\n\n   let reader = new FileReader();\n   await reader.addEventListener('load', async () => {\n     // convert image file to base64 string\n     this.uploadedPhotoURL = reader.result;\n     console.log('Before cropping: ' + reader.result);\n     await this.cropPhoto(this.uploadedPhotoURL);\n   }, true);\n\n   if (formElement) {\n     return reader.readAsDataURL(event.target.files[0]);\n   }\n }\n\n uploadChangedPhoto() {\n\n  const formData = new FormData();\n  formData.append('oldPhotoKey', this.awsPrefix);\n  formData.append('email', this.userEmail);\n\n  const photoFile = new File([this.dataURLtoBlob(this.uploadedPhotoURL)], 'picture.png');\n\n  formData.append('profile-picture-update', photoFile);\n\n  if (this.uploadedPhoto === true) {\n    this.photo.changeProfilePicture(formData).subscribe(\n      data => {\n        console.log(data);\n        let newPhoto = data['objectUrl'];\n        // Update all the creatorProfilePicture properties with newPhoto\n        // this.photo.updatePostPhotos(newPhoto, this.userEmail);\n        this.presentLoading();\n        this.profile.profilePicture.next(newPhoto);\n        this.presentToast();\n        // Get profile pages to refresh with updated profile pics\n        this.postEmitter.postPageRefresh();\n        this.singlePostEmitterService.singlePostPageRefresh();\n        this.router.navigate(['/home/profile']);\n      }\n    );\n  }\n }\n\nasync presentToast() {\n  const toast = await this.toast.create({\n    message: 'Your Profile Picture has been changed',\n    animated: true,\n    cssClass: 'updated-toast',\n    duration: 2000\n  });\n  toast.present();\n}\n\nasync presentLoading() {\n  const loading = await this.loading.create({\n    cssClass: 'my-custom-class',\n    message: 'Updating Photo...',\n    duration: 1000\n  });\n  await loading.present();\n\n  const { role, data } = await loading.onDidDismiss();\n  console.log('Loading dismissed!');\n}\n\nasync cropPhoto(uploadedPhotoURL) {\n  const modal = await this.modal.create({\n    component: ImageCropperPage,\n    cssClass: 'image-cropper',\n    componentProps: {\n      uploadedPhotoURL\n    }\n  });\n\n  await modal.present();\n\n  modal.onDidDismiss().then(data => {\n    this.uploadedPhotoURL = data.data;\n  });\n\n\n}\n\ndataURLtoBlob(dataurl) {\n  let arr = dataurl.split(',');\n  let mime = arr[0].match(/:(.*?);/)[1];\n  let bstr = atob(arr[1]);\n  let n = bstr.length;\n  let u8arr = new Uint8Array(n);\n\n  while(n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new Blob([u8arr], {type: mime});\n}\n\ngoBack() {\n  this.router.navigate(['/home/profile']);\n}\n\n}\n","export default \"<!-- Mobile Header -->\\n<ion-header class=\\\"ion-hide-lg-up\\\">\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>Change Profile Picture</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content class=\\\"ion-text-center\\\">\\n  <ion-grid>\\n    \\n     <!-- Desktop Header -->\\n     <ion-row style=\\\"padding-top: 80px; margin-bottom: 40px;\\\" class=\\\"ion-hide-lg-down ion-justify-content-center\\\">\\n      <ion-col size-xs=\\\"11\\\" size-sm=\\\"10\\\" size-md=\\\"10\\\" size-lg=\\\"8\\\" size-xl=\\\"6\\\">\\n        <ion-toolbar class=\\\"desktop-toolbar\\\">\\n              <ion-buttons slot=\\\"start\\\">\\n                  <h1>Change Profile Picture</h1>\\n              </ion-buttons>\\n              <ion-buttons slot=\\\"end\\\">\\n                <ion-button class=\\\"back-button\\\" (click)=\\\"goBack()\\\">\\n                  Back\\n                </ion-button>\\n              </ion-buttons>\\n        </ion-toolbar>\\n            <!-- <img height=\\\"50\\\" style=\\\"display: inline;\\\" src=\\\"../../../assets/icon/suitcase-blue.svg\\\" alt=\\\"\\\" srcset=\\\"\\\">\\n            <h1 style=\\\"display: inline; margin-left: 15px;\\\">Jobs</h1> -->\\n      </ion-col>\\n    </ion-row>\\n\\n    <!-- Mobile -->\\n    <ion-row class=\\\"ion-justify-content-center\\\">\\n      <ion-col size-xs=\\\"12\\\" size-sm=\\\"10\\\" size-md=\\\"8\\\" size-lg=\\\"6\\\" size-xl=\\\"4\\\">\\n        <h6 class=\\\"text-header\\\">Please select the profile picture you will use to replace your current one. Only pictures with the extentions <span>'.png', '.jpg', and '.jpeg'</span> are allowed. </h6>\\n\\n        <!-- <p>{{awsPrefix}}</p> -->\\n        <img *ngIf=\\\"!uploadedPhoto\\\" id=\\\"profile-picture\\\" src=\\\"{{imageUrl}}\\\" alt=\\\"Profile Picture\\\">\\n\\n\\n        <img *ngIf=\\\"uploadedPhoto\\\" id=\\\"profile-picture\\\" src=\\\"{{uploadedPhotoURL}}\\\" alt=\\\"Profile Picture\\\">\\n\\n        <form\\n        (ngSubmit)=\\\"uploadChangedPhoto()\\\" id=\\\"changePhotoForm\\\">\\n          <input\\n            name=\\\"profile-picture-update\\\"\\n            (change)=\\\"getFormData($event)\\\" placeholder=\\\"Upload Image\\\"\\n            type=\\\"file\\\"/>\\n\\n          <ion-button\\n            type=\\\"submit\\\"\\n            class=\\\"orange-button\\\"\\n            [disabled]=\\\"!imageUrl\\\">Update\\n          </ion-button>\\n        </form>\\n      </ion-col>\\n    </ion-row>\\n  </ion-grid>\\n</ion-content>\\n\";"]}